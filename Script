local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- Oynadığınız her iki oyundaki ID'ler
local targetPlaceId = 16670640252 -- Farm yapılacak oyun ID'si
local returnPlaceId = 3231515867 -- Geri dönülecek oyun ID'si

-- TeleportData üzerinden gönderilen veriyi kontrol et
local teleportData = TeleportService:GetTeleportData() or {}
local comingFromFarm = teleportData.fromFarm  -- true ise geri dönüş sonrası farmdan geliniyor

-- Bildirim gösterme fonksiyonu
local function showNotification(message, duration)
    if UserInputService.TouchEnabled then
        return
    end

    local notificationGui = Instance.new("ScreenGui")
    notificationGui.Parent = player:WaitForChild("PlayerGui")

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0.3, 0, 0.1, 0)
    frame.Position = UDim2.new(0.7, -10, 0.9, -10)
    frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    frame.BorderSizePixel = 2
    frame.BorderColor3 = Color3.fromRGB(255, 255, 255)
    frame.Parent = notificationGui

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.Text = message
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = 24
    label.Parent = frame

    local sound = Instance.new("Sound")
    sound.SoundId = "rbxassetid://2865226178"
    sound.Parent = notificationGui
    sound:Play()

    wait(duration)
    notificationGui:Destroy()
end

-- Botları silme fonksiyonu
local function deleteBots()
    local bots = workspace:FindFirstChild("Botlar")
    if bots then
        bots:Destroy()
        print("Botlar başarıyla silindi.")
    else
        print("Botlar bulunamadı.")
    end
end

-- İstenilen isme ve sınıfa sahip objeyi bulma fonksiyonu
local function getNil(name, class)
    for _, v in next, game:GetDescendants() do
        if v.ClassName == class and v.Name == name then
            return v
        end
    end
end

-- Farm işlemlerini başlatan fonksiyon (targetPlaceId içindeki oyunda çalışır)
local function jumpAndStartFarm()
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid", 10)

    if humanoid then
        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    else
        warn("Humanoid bulunamadı!")
        return
    end

    wait(1)

    -- Farm yapılacak bölgeler ve bekleme süreleri
    local regions = {
        {name = "E", waitTime = 40},
        {name = "F", waitTime = 40},
        {name = "G", waitTime = 40},
        {name = "H", waitTime = 40},
        {name = "C", waitTime = 40},
        {name = "A", waitTime = 40},
        {name = "D", waitTime = 40},
        {name = "B", waitTime = 40}
    }

    for _, region in ipairs(regions) do
        local point = getNil(region.name, "Part")
        if point and character:FindFirstChild("HumanoidRootPart") then
            character.HumanoidRootPart.CFrame = point.CFrame * CFrame.new(0, 3, 0)
            wait(region.waitTime)
        else
            print(region.name .. " bölgesi bulunamadı veya HumanoidRootPart yok.")
        end
    end

    wait(6) -- Farm işlemleri tamamlandıktan sonra bekle
    showNotification("Hedef oyun tamamlandı. Geri dönülüyor...", 3)

    -- Geri dönüş için teleportData içerisine farmdan geldiğimiz bilgisini ekleyelim
    local teleportDataToSend = {
        fromFarm = true
    }
    TeleportService:Teleport(returnPlaceId, player, teleportDataToSend)
end

-- Teleport sonrası çalışacak fonksiyon
local function onTeleportCompleted()
    showNotification("Hedef oyuna teleport edildiniz. Botlar siliniyor ve farma başlıyor.", 3)
    deleteBots()
    wait(1)
    jumpAndStartFarm()
end

-- Oyunun içinde hangi ID'de olduğumuzu kontrol edip gerekli adımı atan fonksiyon
local function checkAndTeleport()
    local currentPlaceId = game.PlaceId
    -- Eğer şu an farm yapılacak oyunda değilsek, farm oyununa geçelim
    if currentPlaceId ~= targetPlaceId then
        showNotification("Hedef oyun ID'sine ışınlanıyorsunuz.", 3)
        -- Geri dönüşte farm işlemlerine başlamamız gerektiğini belirtmek için teleportData ekleyelim
        local teleportDataToSend = {
            fromFarm = false
        }
        TeleportService:Teleport(targetPlaceId, player, teleportDataToSend)
    else
        onTeleportCompleted()
    end
end

-- Ana mantık:  
-- Eğer geri dönüş oyunundan geliniyorsa, checkAndTeleport çağrılır ve farm oyununa geçiş sağlanır.
-- Eğer doğrudan farm oyunundaysak, farm işlemleri başlar.
if game.PlaceId == targetPlaceId then
    -- Eğer TeleportData'da farmdan gelip gelmediği bilgisi varsa,
    -- bu genellikle Teleport sonrası otomatik olarak yeniden çalıştığı için onTeleportCompleted() yeterli.
    if comingFromFarm then
        -- Geri dönüş oyunundan geldiysek, direkt farm işlemlerini başlatıyoruz.
        onTeleportCompleted()
    else
        -- İlk sefer veya teleportData'da farmdan gelmediğine dair veri yoksa da farm işlemleri başlatılır.
        onTeleportCompleted()
    end
else
    -- Eğer şu an geri dönüş oyununda isek, farm oyununa geçmek için checkAndTeleport çağrılır.
    checkAndTeleport()
end
